<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - MemberCommons</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.css">
    
    <!-- Shared Navigation Styles -->
    <link rel="stylesheet" href="../css/navigation.css">
    
    <!-- Page-specific Styles -->
    <link rel="stylesheet" href="../css/projects.css">
    
    <style>
        :root {
            --bg-primary: #F9FAFB;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F3F4F6;
            --text-primary: #1A1A1A;
            --text-secondary: #6B7280;
            --text-muted: #9CA3AF;
            --accent-green: #10B981;
            --accent-blue: #3B82F6;
            --accent-orange: #F59E0B;
            --border-light: #E5E7EB;
            --border-medium: #D1D5DB;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --sidebar-width: 280px;
            --sidebar-collapsed: 64px;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-light);
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius-md);
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-smooth);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--accent-green);
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-open {
            background: #FEF3C7;
            color: #92400E;
        }

        .status-in_progress {
            background: #DBEAFE;
            color: #1E40AF;
        }

        .skill-tag {
            display: inline-block;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 500;
        }

        .skill-tag.small {
            padding: 2px 6px;
            font-size: 11px;
        }

        /* Page content specific styles */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Navigation will be injected here by navigation.js -->
    
    <!-- Opportunities Content -->
    <div id="opportunities-content" class="page-content active">
        <!-- Content will be dynamically loaded by projects.js -->
    </div>

    <!-- Assigned Tasks Content -->
    <div id="assigned-tasks-content" class="page-content">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">My Assigned Tasks</h2>
                <button class="btn btn-secondary">
                    <i data-feather="filter"></i>
                    Filter
                </button>
            </div>
            
            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: var(--radius-md); margin-bottom: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                    <div>
                        <h4 style="margin: 0 0 4px 0;">Database Schema Design</h4>
                        <p style="color: var(--text-secondary); margin: 0; font-size: 14px;">AI-Powered Local Government Dashboard</p>
                    </div>
                    <span class="status-badge status-in_progress">In Progress</span>
                </div>
                <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">Design PostgreSQL schema for city services data with proper relationships and indexing.</p>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 8px;">
                        <span class="skill-tag small">PostgreSQL</span>
                        <span class="skill-tag small">Database Design</span>
                    </div>
                    <span style="font-size: 12px; color: var(--text-muted);">Due: Feb 28, 2024</span>
                </div>
            </div>

            <div style="background: var(--bg-tertiary); padding: 20px; border-radius: var(--radius-md); margin-bottom: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                    <div>
                        <h4 style="margin: 0 0 4px 0;">User Interface Review</h4>
                        <p style="color: var(--text-secondary); margin: 0; font-size: 14px;">Community Resource Mapping Platform</p>
                    </div>
                    <span class="status-badge status-open">Pending</span>
                </div>
                <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 14px;">Review and provide feedback on the mobile interface designs.</p>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; gap: 8px;">
                        <span class="skill-tag small">UX Review</span>
                        <span class="skill-tag small">Mobile Design</span>
                    </div>
                    <span style="font-size: 12px; color: var(--text-muted);">Due: Mar 5, 2024</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Timelines Content -->
    <div id="timelines-content" class="page-content">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Project Timelines</h2>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary">
                        <i data-feather="calendar"></i>
                        Month View
                    </button>
                    <button class="btn btn-secondary">
                        <i data-feather="list"></i>
                        List View
                    </button>
                </div>
            </div>
            
            <div style="background: var(--bg-tertiary); padding: 24px; border-radius: var(--radius-md); text-align: center;">
                <div style="margin-bottom: 16px;">
                    <i data-feather="calendar" style="width: 48px; height: 48px; color: var(--text-muted);"></i>
                </div>
                <h3 style="margin: 0 0 8px 0;">Timeline View Coming Soon</h3>
                <p style="color: var(--text-secondary); margin: 0;">Interactive project timelines with Gantt charts and milestone tracking will be available soon.</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.29.0/dist/feather.min.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/navigation.js"></script>
    <script src="../js/projects.js"></script>
    
    <script>
        // Application State
        const AppState = {
            currentUser: null,
            currentSection: 'projects',
            currentTab: 'opportunities',
            isAuthenticated: false,
            navigation: null
        };

        // Initialize navigation with callbacks
        document.addEventListener('DOMContentLoaded', function() {
            // Parse hash to determine initial tab
            const hash = window.location.hash.slice(1);
            if (hash) {
                AppState.currentTab = hash;
            }

            setTimeout(() => {
                AppState.navigation = initializeNavigation({
                    defaultSection: 'projects',
                    defaultTab: AppState.currentTab,
                    onSectionChange: (section, tab) => {
                        AppState.currentSection = section;
                        AppState.currentTab = tab;
                        
                        // Handle navigation to other single-page apps
                        if (section === 'home') {
                            window.location.href = '../#' + tab;
                            return;
                        } else if (section === 'people') {
                            window.location.href = '../people/#' + tab;
                            return;
                        } else if (section === 'account') {
                            window.location.href = '../account/#' + tab;
                            return;
                        }
                        
                        showContent(tab);
                        updatePageTitle(section, tab);
                    },
                    onTabChange: (tab, section) => {
                        AppState.currentTab = tab;
                        
                        // Handle navigation to other single-page apps
                        if (section === 'home') {
                            window.location.href = '../#' + tab;
                            return;
                        } else if (section === 'people') {
                            window.location.href = '../people/#' + tab;
                            return;
                        } else if (section === 'account') {
                            window.location.href = '../account/#' + tab;
                            return;
                        }
                        
                        showContent(tab);
                        updatePageTitle(section, tab);
                    },
                    onSidebarToggle: (collapsed) => {
                        console.log('Sidebar toggled:', collapsed ? 'collapsed' : 'expanded');
                    }
                });

                // Move existing page content into the navigation structure
                const pageContents = document.querySelectorAll('.page-content');
                const tabContent = document.getElementById('tab-content');
                if (tabContent && pageContents.length > 0) {
                    pageContents.forEach(content => {
                        tabContent.appendChild(content);
                    });
                }

                // Initialize feather icons
                initializeFeatherIcons();

                // Show initial content
                showContent(AppState.currentTab);
                updatePageTitle(AppState.currentSection, AppState.currentTab);

                // Initialize projects.js if available
                if (window.projectsManager) {
                    window.projectsManager.init();
                }
            }, 100);

            // Handle hash changes for direct navigation
            window.addEventListener('hashchange', function() {
                const hash = window.location.hash.slice(1);
                if (hash && hash !== AppState.currentTab) {
                    AppState.currentTab = hash;
                    showContent(hash);
                    updatePageTitle(AppState.currentSection, hash);
                    
                    // Update navigation state
                    if (AppState.navigation) {
                        AppState.navigation.switchTab(hash);
                    }
                }
            });
        });

        // Content management functions
        function showContent(tabId) {
            // Hide all content
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show target content
            const targetContent = document.getElementById(tabId + '-content');
            if (targetContent) {
                targetContent.classList.add('active');
            }

            // Update feather icons after content change
            initializeFeatherIcons();

            // Load dynamic content if needed
            if (tabId === 'opportunities' && window.projectsManager) {
                window.projectsManager.loadOpportunities();
            }
        }

        function updatePageTitle(section, tab) {
            const titles = {
                'projects': {
                    'opportunities': 'Opportunities - Projects - MemberCommons',
                    'assigned-tasks': 'Assigned Tasks - Projects - MemberCommons',
                    'timelines': 'Timelines - Projects - MemberCommons'
                }
            };

            const title = titles[section]?.[tab] || 'Projects - MemberCommons';
            document.title = title;
        }

        // Public API for external scripts
        window.MemberCommons = {
            getAppState: () => AppState,
            showContent: showContent,
            updatePageTitle: updatePageTitle
        };
    </script>
</body>
</html>